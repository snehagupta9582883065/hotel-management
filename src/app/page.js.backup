"use client";
import React from 'react';
import Link from 'next/link';
import { motion } from 'framer-motion';
import {
  TrendingUp, Users, CalendarCheck, DollarSign,
  ArrowUpRight, LogIn, LogOut,
  Bed, FileText, Plus, Search, AlertCircle, ChevronRight
} from 'lucide-react';
import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';

// Mock Data
const revenueData = [
  { name: 'Jan 3', revenue: 4000, bookings: 24 },
  { name: 'Jan 4', revenue: 5000, bookings: 28 },
  { name: 'Jan 5', revenue: 4500, bookings: 25 },
  { name: 'Jan 6', revenue: 6000, bookings: 35 },
  { name: 'Jan 7', revenue: 5500, bookings: 30 },
  { name: 'Jan 8', revenue: 7000, bookings: 42 },
  { name: 'Jan 9', revenue: 6500, bookings: 38 },
];

const rooms = [
  { id: '101', type: 'Standard', status: 'occupied', guest: 'John Doe' },
  { id: '102', type: 'Standard', status: 'available', guest: '-' },
  { id: '103', type: 'Deluxe', status: 'occupied', guest: 'Jane Smith' },
  { id: '104', type: 'Standard', status: 'cleaning', guest: '-' },
  { id: '201', type: 'Suite', status: 'occupied', guest: 'Bob Wilson' },
  { id: '202', type: 'Suite', status: 'available', guest: '-' },
  { id: '203', type: 'Deluxe', status: 'maintenance', guest: '-' },
  { id: '204', type: 'Standard', status: 'available', guest: '-' },
];

// Animation Variants
const containerVariant = {
  hidden: { opacity: 0 },
  show: {
    opacity: 1,
    transition: {
      staggerChildren: 0.1
    }
  }
};

const itemVariant = {
  hidden: { opacity: 0, y: 20 },
  show: { opacity: 1, y: 0 }
};

// Components
const StatCard = ({ title, value, icon: Icon, trend, subtext }) => (
  <motion.div
    variants={itemVariant}
    whileHover={{ y: -12, scale: 1.03 }}
    className="relative bg-gradient-to-br from-bg-secondary via-bg-secondary to-bg-primary rounded-3xl p-6 border border-border-color hover:border-purple-500/60 transition-all duration-500 overflow-hidden group cursor-pointer"
    style={{
      boxShadow: '0 4px 20px rgba(0, 0, 0, 0.05), 0 0 0 1px rgba(139, 92, 246, 0.05)',
    }}
  >
    {/* Animated gradient background */}
    <div className="absolute inset-0 bg-gradient-to-br from-purple-500/0 via-purple-500/5 to-blue-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500" />

    {/* Shimmer effect */}
    <div className="absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-700">
      <div className="absolute inset-0 -translate-x-full group-hover:translate-x-full transition-transform duration-1000 bg-gradient-to-r from-transparent via-white/10 to-transparent" />
    </div>

    {/* Top gradient border */}
    <div className="absolute top-0 left-0 right-0 h-[2px] bg-gradient-to-r from-transparent via-purple-500 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500" />

    {/* Bottom glow */}
    <div className="absolute bottom-0 left-1/2 -translate-x-1/2 w-3/4 h-px bg-gradient-to-r from-transparent via-purple-500/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500" />

    <div className="relative z-10">
      <div className="flex justify-between items-start mb-5">
        <div className="flex-1">
          <p className="text-text-secondary text-[10px] font-bold uppercase tracking-[1.5px] mb-3 opacity-70">{title}</p>
          <h3 className="text-4xl font-extrabold text-text-primary tracking-tight bg-gradient-to-br from-text-primary to-text-primary/70 bg-clip-text">{value}</h3>
        </div>

        {/* Floating icon with multiple layers */}
        <div className="relative">
          {/* Outer glow ring */}
          <div className="absolute inset-0 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 opacity-20 blur-xl group-hover:opacity-40 transition-opacity duration-500" />

          {/* Icon container */}
          <motion.div
            whileHover={{ rotate: 360, scale: 1.1 }}
            transition={{ duration: 0.6, ease: "easeInOut" }}
            className="relative w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-500 via-purple-600 to-purple-700 shadow-2xl shadow-purple-500/40 flex items-center justify-center text-white group-hover:shadow-purple-500/60 transition-shadow duration-500"
          >
            {/* Inner shine */}
            <div className="absolute inset-[1px] rounded-2xl bg-gradient-to-br from-white/20 to-transparent opacity-50" />
            <Icon size={28} className="relative z-10 drop-shadow-lg" strokeWidth={2.5} />
          </motion.div>
        </div>
      </div>

      {subtext && <p className="text-xs text-text-secondary mt-2 opacity-80">{subtext}</p>}

      {trend && (
        <div className="flex items-center gap-2 mt-4 pt-4 border-t border-border-color/50">
          <motion.div
            whileHover={{ scale: 1.05 }}
            className={`flex items-center gap-1.5 px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm ${trend > 0
              ? 'bg-gradient-to-r from-green-50 to-emerald-50 text-green-600 border border-green-200/50 dark:from-green-900/20 dark:to-emerald-900/20 dark:text-green-400 dark:border-green-800/50'
              : 'bg-gradient-to-r from-red-50 to-rose-50 text-red-600 border border-red-200/50 dark:from-red-900/20 dark:to-rose-900/20 dark:text-red-400 dark:border-red-800/50'
              }`}
          >
            {trend > 0 ? (
              <>
                <TrendingUp size={14} strokeWidth={3} />
                <span>+{trend}%</span>
              </>
            ) : (
              <>
                <TrendingDown size={14} strokeWidth={3} />
                <span>{trend}%</span>
              </>
            )}
          </motion.div>
          <span className="text-xs text-text-secondary font-medium opacity-70">vs last month</span>
        </div>
      )}
    </div>

    {/* Corner accent */}
    <div className="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-purple-500/5 to-transparent rounded-full blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
  </motion.div>
);

const QuickLink = ({ icon: Icon, label }) => (
  <motion.div
    variants={itemVariant}
    whileHover={{ scale: 1.05 }}
    whileTap={{ scale: 0.95 }}
    className="bg-bg-secondary rounded-2xl p-6 border border-border-color hover:border-purple-500 transition-all duration-300 cursor-pointer flex flex-col items-center justify-center gap-3 group"
  >
    <div className="w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500/10 to-purple-600/10 backdrop-blur-sm border border-purple-500/20 flex items-center justify-center text-purple-600 group-hover:from-purple-500/20 group-hover:to-purple-600/20 transition-all">
      <Icon size={24} />
    </div>
    <span className="text-sm font-semibold text-text-primary">{label}</span>
  </motion.div>
);

const RoomStatusCard = ({ room }) => {
  const getStatusColor = (status) => {
    switch (status) {
      case 'available': return 'text-green-500';
      case 'occupied': return 'text-purple-600';
      case 'cleaning': return 'text-yellow-500';
      case 'maintenance': return 'text-red-500';
      default: return 'text-gray-500';
    }
  };

  const getStatusBg = (status) => {
    switch (status) {
      case 'available': return 'bg-green-50 text-green-600 border-green-200 dark:bg-green-900/20 dark:text-green-400 dark:border-green-800';
      case 'occupied': return 'bg-purple-50 text-purple-600 border-purple-200 dark:bg-purple-900/20 dark:text-purple-400 dark:border-purple-800';
      case 'cleaning': return 'bg-yellow-50 text-yellow-600 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-400 dark:border-yellow-800';
      case 'maintenance': return 'bg-red-50 text-red-600 border-red-200 dark:bg-red-900/20 dark:text-red-400 dark:border-red-800';
      default: return 'bg-gray-50 text-gray-600 border-gray-200 dark:bg-gray-900/20 dark:text-gray-400 dark:border-gray-800';
    }
  };

  return (
    <motion.div
      variants={itemVariant}
      className="bg-bg-secondary rounded-2xl border border-border-color p-4 flex flex-col items-center h-[180px] group hover:shadow-lg hover:border-purple-500 transition-all duration-300"
    >
      <div className="flex items-start justify-between w-full mb-2">
        <span className="text-[10px] font-bold uppercase px-2 py-0.5 rounded-full border border-border-color text-text-secondary bg-bg-primary">
          {room.type}
        </span>
        <div className={`p-2 rounded-xl bg-bg-primary group-hover:scale-110 transition-transform duration-300`}>
          <Bed size={18} className={getStatusColor(room.status)} />
        </div>
      </div>

      <div className="flex flex-col items-center gap-1 my-auto">
        <h4 className="text-2xl font-bold tracking-tight text-text-primary">{room.id}</h4>
        <div className="flex items-center gap-1.5 min-h-[20px]">
          {room.guest !== '-' ? (
            <>
              <Users size={12} className="text-text-secondary" />
              <span className="text-sm font-medium text-text-secondary truncate max-w-[100px]">{room.guest}</span>
            </>
          ) : (
            <span className="text-xs text-text-secondary/50 font-medium">No Guest</span>
          )}
        </div>
      </div>

      <div className="w-full mt-auto pt-3 border-t border-dashed border-border-color">
        <div className={`text-center px-3 py-1.5 rounded-lg text-xs font-semibold uppercase border ${getStatusBg(room.status)}`}>
          {room.status}
        </div>
      </div>
    </motion.div>
  );
};

export default function Dashboard() {
  return (
    <motion.div
      initial="hidden"
      animate="show"
      variants={containerVariant}
      className="flex flex-col gap-8"
    >
      {/* Top Stats Row */}
      <motion.div variants={containerVariant} className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6">
        <StatCard title="Total Rooms" value="50" icon={Bed} />
        <StatCard title="Available Rooms" value="15" icon={Bed} />
        <StatCard title="Occupied Rooms" value="32" icon={Users} trend={12} />
        <StatCard title="Today's Revenue" value="$6,800" icon={DollarSign} trend={8.5} />
        <StatCard title="Today's Check-ins" value="5" icon={LogIn} />
        <StatCard title="Today's Check-outs" value="3" icon={LogOut} />
      </motion.div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Revenue Chart */}
        <motion.div
          variants={itemVariant}
          className="lg:col-span-2 bg-bg-secondary rounded-2xl p-6 border border-border-color"
        >
          <div className="mb-6">
            <h3 className="flex items-center gap-2 text-xl font-bold text-text-primary">
              <TrendingUp size={18} className="text-purple-600" />
              Revenue Overview
            </h3>
          </div>
          <div className="h-[300px]">
            <ResponsiveContainer width="100%" height="100%">
              <AreaChart data={revenueData}>
                <defs>
                  <linearGradient id="colorRevenue" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.3} />
                    <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0} />
                  </linearGradient>
                  <linearGradient id="colorBookings" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.3} />
                    <stop offset="95%" stopColor="#3b82f6" stopOpacity={0} />
                  </linearGradient>
                </defs>
                <CartesianGrid strokeDasharray="3 3" stroke="var(--border-color)" vertical={false} />
                <XAxis dataKey="name" stroke="var(--text-secondary)" tick={{ fontSize: 12 }} axisLine={false} tickLine={false} />
                <YAxis stroke="var(--text-secondary)" tick={{ fontSize: 12 }} axisLine={false} tickLine={false} tickFormatter={(val) => `$${val}`} />
                <Tooltip
                  contentStyle={{ backgroundColor: 'var(--bg-secondary)', borderRadius: '12px', border: '1px solid var(--border-color)', boxShadow: '0 4px 12px rgba(0,0,0,0.1)' }}
                  itemStyle={{ color: 'var(--text-primary)' }}
                />
                <Area type="monotone" dataKey="revenue" stroke="#8b5cf6" strokeWidth={3} fillOpacity={1} fill="url(#colorRevenue)" />
                <Area type="monotone" dataKey="bookings" stroke="#3b82f6" strokeWidth={3} fillOpacity={1} fill="url(#colorBookings)" />
              </AreaChart>
            </ResponsiveContainer>
          </div>
        </motion.div>

        {/* Occupancy Overview */}
        <motion.div
          variants={itemVariant}
          className="bg-bg-secondary rounded-2xl p-6 border border-border-color"
        >
          <div className="mb-6">
            <h3 className="flex items-center gap-2 text-xl font-bold text-text-primary">
              <CalendarCheck size={18} className="text-purple-600" />
              Occupancy Overview
            </h3>
          </div>

          <div className="mb-6">
            <div className="flex justify-between items-center mb-3">
              <span className="text-sm font-medium text-text-secondary">Occupancy Rate</span>
              <span className="text-text-primary font-bold">64%</span>
            </div>
            <div className="w-full h-3 bg-bg-primary rounded-full overflow-hidden">
              <motion.div
                initial={{ width: 0 }}
                animate={{ width: '64%' }}
                transition={{ duration: 1.5, ease: "easeOut" }}
                className="h-full bg-gradient-to-r from-purple-600 to-purple-400 rounded-full shadow-lg shadow-purple-500/40"
              />
            </div>
          </div>

          <div className="grid grid-cols-2 gap-3">
            <motion.div whileHover={{ scale: 1.02 }} className="bg-green-50 dark:bg-green-900/10 rounded-xl p-4 border border-green-200 dark:border-green-800">
              <span className="text-xs font-medium text-text-secondary block mb-1">Available</span>
              <span className="text-2xl font-bold text-green-600">15</span>
            </motion.div>
            <motion.div whileHover={{ scale: 1.02 }} className="bg-blue-50 dark:bg-blue-900/10 rounded-xl p-4 border border-blue-200 dark:border-blue-800">
              <span className="text-xs font-medium text-text-secondary block mb-1">Occupied</span>
              <span className="text-2xl font-bold text-blue-500">32</span>
            </motion.div>
            <motion.div whileHover={{ scale: 1.02 }} className="bg-yellow-50 dark:bg-yellow-900/10 rounded-xl p-4 border border-yellow-200 dark:border-yellow-800">
              <span className="text-xs font-medium text-text-secondary block mb-1">Cleaning</span>
              <span className="text-2xl font-bold text-yellow-600">2</span>
            </motion.div>
            <motion.div whileHover={{ scale: 1.02 }} className="bg-red-50 dark:bg-red-900/10 rounded-xl p-4 border border-red-200 dark:border-red-800">
              <span className="text-xs font-medium text-text-secondary block mb-1">Maintenance</span>
              <span className="text-2xl font-bold text-red-500">1</span>
            </motion.div>
          </div>
        </motion.div>
      </div>

      {/* Quick Links */}
      <motion.div variants={containerVariant}>
        <h3 className="text-xl font-bold text-text-primary mb-4">Quick Links</h3>
        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
          <QuickLink icon={Plus} label="New Booking" />
          <QuickLink icon={LogIn} label="Check In" />
          <QuickLink icon={LogOut} label="Check Out" />
          <QuickLink icon={Bed} label="Rooms" />
          <QuickLink icon={Users} label="Guests" />
          <QuickLink icon={FileText} label="Reports" />
        </div>
      </motion.div>

      {/* Room Status Overview */}
      <motion.div variants={containerVariant} className="flex flex-col gap-4">
        <div className="flex justify-between items-center">
          <h3 className="text-xl font-bold text-text-primary">Room Status Overview</h3>
          <Link href="/room-management" className="flex items-center gap-1 text-sm font-medium text-purple-600 hover:text-purple-700 transition-colors">
            View All Rooms <ArrowUpRight size={16} />
          </Link>
        </div>
        <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4">
          {rooms.map((room) => (
            <RoomStatusCard key={room.id} room={room} />
          ))}
        </div>
      </motion.div>
    </motion.div>
  );
}
